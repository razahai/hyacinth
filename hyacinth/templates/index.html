{% extends "base.html" %}

{% block title %}
    Home
{% endblock %}

{% block content %}
    <div class="w-full flex-1 min-h-0 flex items-center justify-center">
        <div id="container" class="flex flex-col border-hyacinth-primary rounded-md border-[0.1em] w-[70%] h-[90%]">
            <div id="header" class="w-full py-2 px-5 bg-hyacinth-primary font-extralight font-sans flex items-center justify-between">
                <div class="flex justify-center items-center">
                    <img 
                        src="{{ url_for('static', filename='img/hyacinth-logo-300x300.svg') }}"
                        width="48"
                        class="inline"
                    />
                    <h1 class="text-2xl text-white font-bold">
                        Hyacinth Printing
                    </h1>
                </div>
                <a href="{{ context.REQUEST_FORM }}" class="rounded-md bg-hyacinth-secondary px-5 py-2 transition duration-200 hover:bg-[#e0d6c3]">
                    <i class="fa-solid fa-key mr-2"></i>
                    Request Access Code
                </a>
            </div>
            <div class="w-full min-h-0 flex-1 flex justify-center items-center">
                <div id="sidebar" class="flex flex-col border-r-[0.1em] border-hyacinth-primary px-3 py-5 min-w-[25%] h-full">
                    <span class="text-xl font-medium my-2">
                        Statistics
                    </span>
                    <div class="flex justify-center items-center space-y-2 flex-col w-full px-3">
                        <div class="flex justify-between w-full space-x-4 items-center">
                            <span class="text-sm font-light text-center">
                                <i class="fa-solid fa-print mr-2"></i>
                                Overall Jobs
                            </span>
                            <span class="text-sm text-center">
                                {{ context.overall_jobs }}
                            </span>
                        </div>
                        <div class="flex justify-between w-full space-x-4 items-center">
                            <span class="text-sm font-light text-center">
                                <i class="fa-solid fa-user mr-2"></i>
                                Your Jobs
                            </span>
                            <span class="text-sm text-center">
                                {{ context.user_jobs }}
                            </span>
                        </div>
                        <div class="flex justify-between w-full space-x-4 items-center">
                            <span class="text-sm font-light text-center">
                                <i class="fa-solid fa-truck mr-2"></i>
                                In Progress
                            </span>
                            <span class="text-sm text-center">
                                {{ context.in_progress_jobs }}
                            </span>
                        </div>
                        <div class="flex justify-between w-full space-x-4 items-center">
                            <span class="text-sm font-light text-center">
                                <i class="fa-solid fa-person-circle-check mr-2"></i>
                                Pending
                            </span>
                            <span class="text-sm text-center">
                                {{ context.pending_jobs }}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="flex-grow px-3 py-5 h-full overflow-y-scroll">                    
                    <div class="mt-2">
                        <h2 class="text-xl font-medium mb-2">
                            Printing Service
                        </h2>
                        <div class="text-sm font-light [&_span]:block leading-7">
                            <span>
                                Before you continue, please read the following: 
                            </span>
                            <ul class="ml-10 list-disc">
                                <li>
                                    The following formats are supported: 
                                    <strong>
                                        {% for type in context.ALLOWED_FILE_TYPES[:-1] %}
                                            {{ type }}, 
                                        {% endfor %}
                                        {{ context.ALLOWED_FILE_TYPES[-1] }}
                                    </strong>
                                </li>
                                <li>
                                    You can print a maximum of <strong>{{ context.MAX_PAGES_PER_JOB }}</strong> pages per print job.
                                </li>
                                <li>
                                    You can submit a print job every <strong>{{ context.PRINT_JOB_RATE_LIMIT }}</strong> minutes.
                                </li>
                                <li>
                                    Delivery can take up to one business day.
                                </li>
                                <li>
                                    Abuse will result in immediate removal from the Hyacinth Printing service. 
                                </li>
                            </ul>
                        </div>
                        <form class="print-job-form mt-4" action="" method="post" enctype="multipart/form-data">
                            {{ form.hidden_tag() }}
                            
                            <div class="relative">
                            <label for="print_job" class="block font-normal mb-4 cursor-pointer">
                                {{ form.print_job.label }}
                                <br/>
                                <span class="inline-block font-light mt-2 text-sm bg-hyacinth-secondary py-2 px-4 rounded-md transition duration-200 hover:bg-[#e0d6c3]">
                                    <i class="fa-solid fa-upload mr-2"></i>
                                    Choose File
                                </span>
                                <span class="ml-2 text-gray-500 text-sm file-upload-filename">No file chosen</span>
                            </label>
                            {{ form.print_job(class="file-upload-input absolute opacity-0 w-full h-full top-0 left-0 cursor-pointer") }}
                            </div>
                            {% if form.print_job.errors %}
                                <ul class="text-sm my-4">
                                    {% for error in form.print_job.errors %}
                                        <li class="text-red-600">{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            
                            {{ form.recaptcha }}
                            {% if form.recaptcha.errors %}
                                <ul class="text-sm mt-4">
                                    {% for error in form.recaptcha.errors %}
                                        <li class="text-red-600">{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}

                            {{ form.submit(class="mt-4 text-sm font-light bg-hyacinth-secondary py-2 px-10 rounded-md transition duration-200 hover:bg-[#e0d6c3] cursor-pointer") }}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        const fileUploadInput = document.querySelector(".file-upload-input");
        const fileUploadFilename = document.querySelector(".file-upload-filename");
        
        fileUploadInput.addEventListener("change", function() {
            const printJobs = Array.from(this.files).map(file => file.name);
            const filenames = printJobs ? printJobs.join(", ") : "No file chosen";
            fileUploadFilename.textContent = filenames.length > 30 ? filenames.slice(0, 27) + "..." : filenames;
        });
    </script>
{% endblock %}